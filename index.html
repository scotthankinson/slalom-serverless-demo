<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Serverless Compute</title>

		<meta name="description" content="Building full stack websites with minimal infrastructure">
		<meta name="author" content="Scott Hankinson">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/white.css" id="theme">
		<link rel="shortcut icon" href="assets/favicon.ico" type="image/vnd.microsoft.icon">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">
		
		<!-- Style Overides -->
		<style>
			
			.reveal h1,
			.reveal h2,
			.reveal h3,
			.reveal h4,
			.reveal h5,
			.reveal h6 {
				margin: 0 0 20px 0;
				color: #006dc7;
				font-family: "Source Sans Pro", Helvetica, sans-serif;
				font-weight: 600;
				line-height: 1.2;
				letter-spacing: normal;
				text-transform: uppercase;
				text-shadow: none;
				word-wrap: break-word; }

			.reveal section img {
				margin: 15px 0px;
				background: rgba(255, 255, 255, 0.12);
				border: 4px solid #006dc7;
				box-shadow: 0 0 10px rgba(0, 0, 0, 0.15); 
			}
			.reveal {
				font-family: "Source Sans Pro", Helvetica, sans-serif;
				font-size: 42px;
				font-weight: normal;
				color: #006dc7; 
			}

		</style>

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h2>Serverless Demo</h2>
					<h4>Building a full stack website with minimal infrastructure</h4>
					<br>
					<p>
						<small>Prepared by Scott Hankinson / Slalom Consulting</small>
					</p>
					<aside class="notes">
						Reminder:  Slides go down before the go across<br/>
						Space Bar: next slide (down or across)<br/>
						F: full screen<br/>
						S: Speaker notes<br/>
						Esc: Full view<br/>
					</aside>
				</section>

				<section>
					<section>
						<img data-src="assets/About_Slalom.png"></img>
					</section>
					<section>
						<img data-src="assets/About_Slalom_2.png"></img>
					</section>
					<section>
						<img data-src="assets/About_Slalom_4.png"></img>
					</section>
					<section>
						<img data-src="assets/About_Slalom_3.png"></img>
					</section>
				</section>

				<section>
					<section>
						<h3>What is Serverless?</h3>
						<small>
							<q cite="https://en.wikipedia.org/wiki/Serverless_computing">
								&ldquo;Serverless computing, also known as function as a service (FaaS), is a cloud computing code execution model in which the cloud provider fully manages starting and stopping of a function's container platform as a service (PaaS) as necessary to serve requests, and requests are billed by an abstract measure of the resources required to satisfy the request, rather than per virtual machine, per hour.&rdquo;
							</q>
						</small>
					</section>
					<section>
						<small>
							<q cite="https://en.wikipedia.org/wiki/Serverless_computing">
								<b>&ldquo;Despite the name, it does not actually involve running code without servers</b>. The name "serverless computing" is used because the business or person that owns the system does not have to purchase, rent or provision servers or virtual machines for the back-end code to run on.&rdquo;
								<br>
								<br>
								Miller, Ron (24 Nov 2015). <a href="https://techcrunch.com/2015/11/24/aws-lamda-makes-serverless-applications-a-reality/">"AWS Lambda Makes Serverless Applications A Reality"</a>
							</q>
						</small>
					</section>
					<section>
						<h3>More than just Lambda</h3>
						<img data-src="assets/AWS_Serverless_Expanded.png" style="max-width: 720px; max-height: auto; background-color: white"></img>
					</section>
				</section>
				
				<section>
					<section>
						<h3>Lambda</h3>
						<img data-src="assets/Lambda_HowItWorks.png"></img>
					</section>							
					<section>
						<h2>What languages are supported?</h2>
						<p>
							<img data-src="assets/Lambda_Inline.PNG"></img>
							<small><b>Node.js</b>, <b>Python</b>, and <b>Ruby</b> support in-line code editing for quick testing, while <b>Java</b>, <b>C#</b>, <b>Go</b>, and <b>PowerShell</b> require deployment packages.  For any complex function, deployment packages and a deploymnet tool will be a must.</small>
						</p>
					</section>
					<section>
						<h2>Node.js 8.10 and 10</h2>
						<pre><code class="hljs" data-trim contenteditable>
'use strict';

console.log('Loading function');

exports.handler = (event, context, callback) => {
    //console.log('Received event:', JSON.stringify(event, null, 2));
    console.log('value1 =', event.key1);
    console.log('value2 =', event.key2);
    console.log('value3 =', event.key3);
    callback(null, event.key1);  // Echo back the first key value
    //callback('Something went wrong');
};

						</code></pre>
					</section>
					<section>
						<h2>Python 2.7, 3.6, and 3.7</h2>
						<pre><code class="hljs" data-trim contenteditable>
from __future__ import print_function

import json

print('Loading function')

def lambda_handler(event, context):
    #print("Received event: " + json.dumps(event, indent=2))
    print("value1 = " + event['key1'])
    print("value2 = " + event['key2'])
    print("value3 = " + event['key3'])
    return event['key1']  # Echo back the first key value
    #raise Exception('Something went wrong')

						</code></pre>
					</section>
					<section>
						<h2>Ruby 2.5</h2>
						<pre><code class="hljs" data-trim contenteditable>
module LambdaFunctions
  class Handler
    def self.process(event:,context:)
      "Hello!"
    end
  end
end

						</code></pre>
					</section>					
					<section>
						<h2>Java 8</h2>
						<pre><code class="hljs" data-trim contenteditable>
package example;

import com.amazonaws.services.lambda.runtime.Context; 
import com.amazonaws.services.lambda.runtime.LambdaLogger;

public class Hello {
    public String myHandler(int myCount, Context context) {
        LambdaLogger logger = context.getLogger();
        logger.log("received : " + myCount);
        return String.valueOf(myCount);
    }
}

						</code></pre>
					</section>
					<section>
							<h2>Go 1.x</h2>
							<pre><code class="hljs" data-trim contenteditable>
	package main
	
	import (
			"fmt"
			"context"
			"github.com/aws/aws-lambda-go/lambda"
	)
	
	type MyEvent struct {
			Name string `json:"name"`
	}
	
	func HandleRequest(ctx context.Context, name MyEvent) (string, error) {
			return fmt.Sprintf("Hello %s!", name.Name ), nil
	}
	
	func main() {
			lambda.Start(HandleRequest)
	}
	
							</code></pre>
						</section>					
						<section>
							<h2>.NET Core 1.0 and 2.1 and PowerShell 6.0</h2>
						<pre><code class="hljs" data-trim contenteditable>
using Amazon.Lambda.Core; 
namespace LambdaFunctionExample{
public class Hello {
    public string MyHandler(int count, ILambdaContext context) {
        var logger = context.Logger;
        logger.log("received : " + count);
        return count.ToString();
    }
  }
}

						</code></pre>
					</section>
				</section>

				<section>
					<section>
						<h2>Can we check your references?</h2>
					</section>
					<section>
						<h3>Web Applications</h3>
						<img data-src="assets/Lambda_WebApplications.png"></img>
					</section>
					<section>
						<h3>Mobile Backends</h3>
						<img data-src="assets/Lambda_MobileBackends.png"></img>
					</section>
					<section>
						<h3>ETL</h3>
						<img data-src="assets/Lambda_ETL.png"></img>
					</section>
					<section>
						<h3>Real-time File Processing</h3>
						<img data-src="assets/Lambda_FileProcessing.png"></img>
					</section>
					<section>
						<h3>Real-time Stream Processing</h3>
						<img data-src="assets/Lambda_StreamProcessing.png"></img>
					</section>
					<section>
						<h3>IoT Backends</h3>
						<img data-src="assets/Lambda_IoT.png"></img>
					</section>
				</section>			
				
				<section>
					<section>
						<h2>What about a real example?</h2>
					</section>
					<section>
						<h3>Traditional Web Architecture</h3>
						<img width="500" height="auto" data-src="assets/WebArchitecture.png"</img>
					</section>
					<section>
						<h3>Serverless Architecture</h3>
						<img width="400" height="auto" data-src="assets/ServerlessArchitecture.png"</img>
					</section>
					<section>
						<img data-src="assets/Slalom_Serverless_Story.png"></img>
					</section>					
					<section>
						<img width="575" height="auto" data-src="assets/GSU_Architecture_2.0.png"></img>
					</section>					
				</section>

				<section>
					<section>
						<h2>Demo</h2>
						<ol>
							<li>Route 53 / DNS Configuration / ACM</li>
							<li>HTTP Front End - Route53 and S3</li>
							<li>HTTPS Front End - Route 53, CloudFront and S3</li>
							<li>Back End - Route53, API Gateway, and Lambda</li>
						</ol>
					</section>
					<section>
						Screenshots of the demo for posterity!
					</section>
					<section>
						Purchase a domain and create a Hosted Zone in Route 53 for slalom-serverless-demo.com
						<img data-src="assets/Walkthrough_Route53_Config.png"></img>
					</section>
					<section>
						Static Website in S3 (HTTP Only)<br/>
						<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/website-hosting-custom-domain-walkthrough.html">(Documentation)</a>
					</section>
					<section>
						Create an S3 bucket "www.slalom-serverless-demo.com" and upload some HTML (this HTML)
						<img data-src="assets/Walkthrough_S3.png"></img>
					</section>
					<section>
						Enable static website hosting
						<img style="max-width: 500px; max-height: auto;" data-src="assets/Walkthrough_S3_Website_Hosting.png"></img>
					</section>
					<section>
						Enable public read
						<img data-src="assets/Walkthrough_S3_PublicRead.png"></img>
					</section>
					<section>
						Add an alias for www.slalom-serverless-demo.com pointing at our S3 bucket
						<img data-src="assets/Walkthrough_Route53_S3.png"></img>
					</section>	
					<section>
						Success!  <br/>A static HTTP Website (this one) has been deployed
					</section>
					<section>
						Static Website with CloudFront (HTTPS Enabled)<br/>
						<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/website-hosting-cloudfront-walkthrough.html">(Documentation)</a>
					</section>
					<section>
						Creat a certificate using ACM for <br/>*.slalom-serverless-demo.com<br/> and let it validate automatically via DNS using the provided option
						<img data-src="assets/Walkthrough_ACM.png"></img>
					</section>
					<section>
						Repeat the previous S3 Setup, but the bucket name can be anyting you like
						<img data-src="assets/Walkthrough_S3_HTTPS.png"></img>
					</section>
					<section>
						Create a CloudFront Web Distribution pointing at your S3 bucket<br/>
						<img data-src="assets/Walkthrough_CloudFront.png"></img><br/>
						Use the alternate domain name 'calculator.slalom-serverless-demo.com' and use our ACM certificate.  Set the default root object to 'index.html'.
					</section>
					<section>
						Add the Alias entry for 'calculator.slalom-serverless-demo.com' to your Route53 Hosted Zone, targeting the CloudFront distribution created in the last step.
						<img data-src="assets/Walkthrough_Route53_CloudFront.png"></img><br/>
					</section>
					<section>
						Success!  <br/>We now have an HTTPS-secured static website!<br/>
						<img data-src="assets/Walkthrough_HTTPS_Enabled.png"></img><br/>
					</section>
					<section>
						Next deploy the back-end
						<img style="max-width: 640px; max-height: auto;" data-src="assets/Walkthrough_Deploy_API.png"></img><br/>
					</section>
					<section>
						Create an API Gateway Custom Domain Name targeting the API and using the certificate for<br/>
						api.slalom-serverless-demo.com<br/>
						<img style="max-width: 400px; max-height: auto;" data-src="assets/Walkthrough_CustomDomainName.png"></img><br/>
					</section>
					<section>
						Add the Alias entry for 'api.slalom-serverless-demo.com' to your Route53 Hosted Zone, targeting the 'target domain name' generated in the last step
						<img data-src="assets/Walkthrough_Route53_APIGW.png"></img><br/>
					</section>
					<section>
						Success!  <br/>A static HTTPS Website has been deployed with a Lambda-backed API!
						<br/><br/>
						<a href="https://github.com/scotthankinson/slalom-serverless-demo/tree/original">Link to Presentation website</a><br/>
						<a href="https://github.com/scotthankinson/calculator">Link to Calculator website</a>
					</section>
				</section>

				<section>
					<section>
						<h2>Organization and Automation</h2>
						<p>
							<small>Lambda sounds awesome!  What happens when I have something bigger than hello world?</small>
							<small>How do I manage my-awesome-function across lifecycles?</small>
							<small>Are there convenient ways of grouping shared functionality?</small>
						</p>
					</section>
					<section>
						<h2>Organization - Front End</h2>
						<p>
							<small>Wrap your S3 websites in CloudFront distributions.  S3 is HTTP only, CloudFront supports HTTPS.</small>
						</p>
						<p>
							<small class="fragment">Use DNS to expose your apps and also to make lifecycle management easy.</small>
						</p>
						<p>
							<small class="fragment">Keep multiple versions of your website available in a staging bucket and you can deploy and roll back with s3 cp.</small>
						</p>
						<p>
							<small class="fragment">Remember, anything in the bucket is publicly accessible -- don't put API keys in here!</small>
						</p>
					</section>

					<section>
						<h2>Organization - Back End</h2>
						<p>
							<small>How do you manage routes across multiple API Gateways leveraging multiple groups of Lamba Functions?</small>
						</p>
						<p class="fragment">
							<small>Use a tool!  AWS SAM, Serverless Framework, Chalice</small>
						</p>
					</section>
					<section>
						<h2>Organization - Back End</h2>
						<p>
							<small>These tools provide a way of describing a collection of lambda functions and their events, and then handles generating the CloudFormation to deploy these functions as a unit.</small>
						</p>
						<p>
							<small class="fragment">Multiple collections may then be rolled up under a single API Gateway to generate the public facing API layer.</small>
						</p>
						<p>
							<small class="fragment">Group like code with like in the repository, and have your CI/CD tool issue the command to deploy them as a application</small>
						</p>
					</section>
				</section>

				<section>
					<section>
						<h2>Caveats</h2>
						<h3><small>All Web content must be static</small></h3>
						<p>
							<small class="fragment">We already follow this architectural pattern in may places -- single page applications or static web content (like this site) fueled by APIs on the back end.</small>
						</p>
						<p>
							<small class="fragment">Angular and React are excellent choices for larger applications, but any web framework (or none) will do.</small>
						</p>
						<p>
							<small class="fragment">Excellent for micro-sites or other rarely updated content.</small>
						</p>
					</section>
					<section>
						<h2>Caveats</h2>
						<h3><small>All APIs should be stateless</small></h3>
						<p>
							<small class="fragment">Functions should not rely on state stored to memory or disk, and have limited access to the underlying hardware and environment.</small>
						</p>
						<p>
							<small class="fragment">Consider using purpose-built databases like DynamoDB, Redis, or S3 to store stateful information for your endpoints.</small>
						</p>
						<p>
							<small class="fragment">Keep your functions lean -- too many items in startup lead to slow bloated functions.</small>
						</p>
					</section>
					<section>
						<h2>Caveats</h2>
						<h3><small>Database interactions can be trickier without a REST interface</small></h3>
						<p>
							<small class="fragment">There are strategies for sharing a connection pool, but you are not guaranteed to be able to re-use containers across invocations.  Best effort applies.</small>
						</p>
						<p>
							<small class="fragment">For high throughput, a traditional ORM-backed server environment may still be required.</small>
						</p>
						<p>
							<small class="fragment">We can't say it enough, wherever possible consider using purpose-built databases.  DynamoDB and S3 have great REST APIs. </small>
						</p>
					</section>
					<section>
						<h2>Caveats</h2>
						<h3><small>Environment variables can become tricker without an environment</small></h3>
						<p>
							<small class="fragment">How do you define an environment variable in S3?</small>
						</p>
						<p>
							<small class="fragment">Static config files must be hot-swapped per environment or discovered from the URL.</small>
						</p>
						<p>
							<small class="fragment">Lambda supports environment variables, though we recommend using SSM Parameter Store or Secrets Manager for complex applications.</small>
						</p>
					</section>
					<section>
						<h2>Caveats</h2>
						<h3><small>15 minute execution limit</small></h3>
						<p>
							<small class="fragment">For long-running processes or persistant connections, consider using Fargate or EC2.</small>
						</p>
						<p>
							<small class="fragment">For jobs which can be chunked, it is possible to 'save and continue' by doing a slice of work and then recursing.</small>
						</p>
						<p>
							<small class="fragment">The default timeout is 3s, and the most cost effective model for execution is quick burst.  Any functions which regularly take over a minute may be good candidates for traditional servers.</small>
						</p>
					</section>
					<section>
						<img data-src="assets/Lambda_Pricing.png"></img>
					</section>
				</section>

				<section>
					<section>
						<h2>Questions?</h2>
					</section>
				</section>
				
				<section>
					<section>
						<h2>Thank You!</h2>
					</section>
				</section>


				<section style="text-align: left;">
					<h2>References</h2>
					<p>
						- <a href="https://aws.amazon.com/s3/">AWS S3 -- serverless front end of choice</a> <br>
						- <a href="https://aws.amazon.com/lambda/">AWS Lambda -- serverless back end of choice</a> <br>
						- <a href="https://aws.amazon.com/api-gateway/">AWS API Gateway -- the REST glue to our lambda functions</a> <br>
						- <a href="https://serverless.com/">Serverless Framework -- deployment specialists</a> <br>
						- <a href="https://github.com/hakimel/reveal.js">Reveal.js -- what this presentation was built with</a>
					</p>
				</section>
			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
